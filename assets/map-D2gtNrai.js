import{r as h,j as l}from"./index-BIyoVxsR.js";import{M as D,a as O,N as B,S as Z,L as k,P as z,g as H}from"./csvParse-DmzajvLB.js";const L={dataURL:"",latField:0,lngField:0,nameField:"name",descField:"description",mapStyle:"Light",pinColor:"007cbf",mapCenter:[0,0],mapZoom:1,mapPitch:0,mapBearing:0},V=()=>{const[e,r]=h.useState(L),n=h.useCallback(()=>{const o=window.location.hash.substring(1),c=o.indexOf("?");if(c===-1)return L;const C=o.substring(c+1),x=new URLSearchParams(C),f={...L};return x.forEach((p,m)=>{console.log("Parsing param:",m,p),m==="pinColor"?f.pinColor=p:m==="mapCenter"?f.mapCenter=p.split(",").map(Number):m in f&&p!==""&&(f[m]=p)}),f},[]);return h.useEffect(()=>{r(n());const o=()=>{r(n())};return window.addEventListener("hashchange",o),()=>window.removeEventListener("hashchange",o)},[n]),e};var A={},P={},R=34,y=10,T=13;function I(e){return new Function("d","return {"+e.map(function(r,n){return JSON.stringify(r)+": d["+n+'] || ""'}).join(",")+"}")}function Y(e,r){var n=I(e);return function(o,c){return r(n(o),c,e)}}function M(e){var r=Object.create(null),n=[];return e.forEach(function(o){for(var c in o)c in r||n.push(r[c]=c)}),n}function d(e,r){var n=e+"",o=n.length;return o<r?new Array(r-o+1).join(0)+n:n}function q(e){return e<0?"-"+d(-e,6):e>9999?"+"+d(e,6):d(e,4)}function J(e){var r=e.getUTCHours(),n=e.getUTCMinutes(),o=e.getUTCSeconds(),c=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":q(e.getUTCFullYear())+"-"+d(e.getUTCMonth()+1,2)+"-"+d(e.getUTCDate(),2)+(c?"T"+d(r,2)+":"+d(n,2)+":"+d(o,2)+"."+d(c,3)+"Z":o?"T"+d(r,2)+":"+d(n,2)+":"+d(o,2)+"Z":n||r?"T"+d(r,2)+":"+d(n,2)+"Z":"")}function $(e){var r=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function o(t,a){var i,s,u=c(t,function(g,b){if(i)return i(g,b-1);s=g,i=a?Y(g,a):I(g)});return u.columns=s||[],u}function c(t,a){var i=[],s=t.length,u=0,g=0,b,F=s<=0,v=!1;t.charCodeAt(s-1)===y&&--s,t.charCodeAt(s-1)===T&&--s;function U(){if(F)return P;if(v)return v=!1,A;var E,S=u,N;if(t.charCodeAt(S)===R){for(;u++<s&&t.charCodeAt(u)!==R||t.charCodeAt(++u)===R;);return(E=u)>=s?F=!0:(N=t.charCodeAt(u++))===y?v=!0:N===T&&(v=!0,t.charCodeAt(u)===y&&++u),t.slice(S+1,E-1).replace(/""/g,'"')}for(;u<s;){if((N=t.charCodeAt(E=u++))===y)v=!0;else if(N===T)v=!0,t.charCodeAt(u)===y&&++u;else if(N!==n)continue;return t.slice(S,E)}return F=!0,t.slice(S,s)}for(;(b=U())!==P;){for(var w=[];b!==A&&b!==P;)w.push(b),b=U();a&&(w=a(w,g++))==null||i.push(w)}return i}function C(t,a){return t.map(function(i){return a.map(function(s){return j(i[s])}).join(e)})}function x(t,a){return a==null&&(a=M(t)),[a.map(j).join(e)].concat(C(t,a)).join(`
`)}function f(t,a){return a==null&&(a=M(t)),C(t,a).join(`
`)}function p(t){return t.map(m).join(`
`)}function m(t){return t.map(j).join(e)}function j(t){return t==null?"":t instanceof Date?J(t):r.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:o,parseRows:c,format:x,formatBody:f,formatRows:p,formatRow:m,formatValue:j}}var G=$(","),Q=G.parse;function W(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function _(e,r){return fetch(e,r).then(W)}function K(e){return function(r,n,o){return arguments.length===2&&typeof n=="function"&&(o=n,n=void 0),_(r,n).then(function(c){return e(c,o)})}}var X=K(Q);const ee=({params:e})=>{var j,t;console.log("params",e);const[r,n]=h.useState(null),[o,c]=h.useState(!0),[C,x]=h.useState(null),[f,p]=h.useState(null);h.useEffect(()=>{(async()=>{try{if(e.dataURL&&e.dataURL.length>10){const i=await X(e.dataURL),s=H({data:i,latField:e.latField??0,lngField:e.lngField??0,nameField:e.nameField,descField:e.descField});n(s),c(!1)}}catch(i){console.error("Failed to parse mapFields parameter:",i),x("Invalid mapFields parameter in URL"),c(!1)}})()},[e]);const m=h.useCallback(a=>{var s;const i=(s=a.features)==null?void 0:s[0];if(i&&i.geometry.type==="Point"){const[u,g]=i.geometry.coordinates;p({longitude:u,latitude:g,name:i.properties.name,description:i.properties.description})}},[]);return l.jsxs("div",{className:"h-screen relative",children:[o&&l.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),l.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),C&&l.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:l.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[l.jsx("p",{className:"font-bold",children:"Error"}),l.jsx("p",{children:C})]})}),!o&&l.jsxs(D,{initialViewState:{longitude:Number((j=e.mapCenter)==null?void 0:j[1])||0,latitude:Number((t=e.mapCenter)==null?void 0:t[0])||0,zoom:Number(e.mapZoom)||1,pitch:Number(e.mapPitch)||0,bearing:Number(e.mapBearing)||0},style:{width:"100%",height:"100%"},mapStyle:O[e.mapStyle],interactiveLayerIds:r?["points"]:[],onClick:m,onMouseEnter:a=>{var i,s;((s=(i=a.features)==null?void 0:i[0])==null?void 0:s.layer.id)==="points"&&(a.target.getCanvas().style.cursor="pointer")},onMouseLeave:a=>{a.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://geomapi.com/'>geomapi.com</a> <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[l.jsx(B,{position:"top-right"}),r&&l.jsx(Z,{id:"points-source",type:"geojson",data:r,children:l.jsx(k,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":e.pinColor?`#${e.pinColor}`:"#007cbf","circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),f&&l.jsx(z,{longitude:f.longitude,latitude:f.latitude,anchor:"bottom",onClose:()=>p(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:l.jsxs("div",{className:"p-1",children:[l.jsx("h3",{className:"font-bold text-gray-800",children:f.name}),f.description&&l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:f.description})]})})]})]})},te=()=>{const e=V();return l.jsx(ee,{params:e})},oe=function(){return l.jsx(te,{})};export{oe as component};
