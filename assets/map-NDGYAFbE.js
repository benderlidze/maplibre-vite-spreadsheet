import{r as x,j as s}from"./index-CK947zf8.js";import{M as A,a as D,N as O,S as k,L as B,P as z,g as Z}from"./csvParse-C8ocM7c5.js";var P={},R={},L=34,w=10,T=13;function M(t){return new Function("d","return {"+t.map(function(r,n){return JSON.stringify(r)+": d["+n+'] || ""'}).join(",")+"}")}function J(t,r){var n=M(t);return function(o,l){return r(n(o),l,t)}}function I(t){var r=Object.create(null),n=[];return t.forEach(function(o){for(var l in o)l in r||n.push(r[l]=l)}),n}function p(t,r){var n=t+"",o=n.length;return o<r?new Array(r-o+1).join(0)+n:n}function V(t){return t<0?"-"+p(-t,6):t>9999?"+"+p(t,6):p(t,4)}function Y(t){var r=t.getUTCHours(),n=t.getUTCMinutes(),o=t.getUTCSeconds(),l=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":V(t.getUTCFullYear())+"-"+p(t.getUTCMonth()+1,2)+"-"+p(t.getUTCDate(),2)+(l?"T"+p(r,2)+":"+p(n,2)+":"+p(o,2)+"."+p(l,3)+"Z":o?"T"+p(r,2)+":"+p(n,2)+":"+p(o,2)+"Z":n||r?"T"+p(r,2)+":"+p(n,2)+"Z":"")}function q(t){var r=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function o(e,a){var m,i,c=l(e,function(C,h){if(m)return m(C,h-1);i=C,m=a?J(C,a):M(C)});return c.columns=i||[],c}function l(e,a){var m=[],i=e.length,c=0,C=0,h,b=i<=0,f=!1;e.charCodeAt(i-1)===w&&--i,e.charCodeAt(i-1)===T&&--i;function u(){if(b)return R;if(f)return f=!1,P;var v,y=c,N;if(e.charCodeAt(y)===L){for(;c++<i&&e.charCodeAt(c)!==L||e.charCodeAt(++c)===L;);return(v=c)>=i?b=!0:(N=e.charCodeAt(c++))===w?f=!0:N===T&&(f=!0,e.charCodeAt(c)===w&&++c),e.slice(y+1,v-1).replace(/""/g,'"')}for(;c<i;){if((N=e.charCodeAt(v=c++))===w)f=!0;else if(N===T)f=!0,e.charCodeAt(c)===w&&++c;else if(N!==n)continue;return e.slice(y,v)}return b=!0,e.slice(y,i)}for(;(h=u())!==R;){for(var d=[];h!==P&&h!==R;)d.push(h),h=u();a&&(d=a(d,C++))==null||m.push(d)}return m}function F(e,a){return e.map(function(m){return a.map(function(i){return j(m[i])}).join(t)})}function g(e,a){return a==null&&(a=I(e)),[a.map(j).join(t)].concat(F(e,a)).join(`
`)}function S(e,a){return a==null&&(a=I(e)),F(e,a).join(`
`)}function U(e){return e.map(E).join(`
`)}function E(e){return e.map(j).join(t)}function j(e){return e==null?"":e instanceof Date?Y(e):r.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:o,parseRows:l,format:g,formatBody:S,formatRows:U,formatRow:E,formatValue:j}}var G=q(","),H=G.parse;function Q(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function W(t,r){return fetch(t,r).then(Q)}function _(t){return function(r,n,o){return arguments.length===2&&typeof n=="function"&&(o=n,n=void 0),W(r,n).then(function(l){return t(l,o)})}}var $=_(H);const K=()=>{const[t,r]=x.useState(null),[n,o]=x.useState(!0),[l,F]=x.useState(null),[g,S]=x.useState(null),E=new URLSearchParams(window.location.search).get("mapFields")??"",j=decodeURIComponent(E),e=JSON.parse(j),a=A[e.mapStyle]||A.Light,m=e.pinColor??"#007cbf",i=e.mapCenter||{lat:0,lng:0},c=e.mapZoom||1,C=e.mapPitch||0,h=e.mapBearing||0;x.useEffect(()=>{(async()=>{try{if(e.dataURL&&e.dataURL.length>10){const u=await $(e.dataURL);console.log("csvData",u);const d=Z({data:u,latField:e.latField,lngField:e.lngField,nameField:e.nameField,descField:e.descField});r(d),o(!1)}}catch(u){console.error("Failed to parse mapFields parameter:",u),F("Invalid mapFields parameter in URL"),o(!1)}})()},[]);const b=x.useCallback(f=>{var d;const u=(d=f.features)==null?void 0:d[0];if(u&&u.geometry.type==="Point"){const[v,y]=u.geometry.coordinates;S({longitude:v,latitude:y,name:u.properties.name,description:u.properties.description})}},[]);return s.jsxs("div",{className:"h-screen relative",children:[n&&s.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),l&&s.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[s.jsx("p",{className:"font-bold",children:"Error"}),s.jsx("p",{children:l})]})}),s.jsxs(D,{initialViewState:{longitude:i.lng,latitude:i.lat,zoom:c,pitch:C,bearing:h},style:{width:"100%",height:"100%"},mapStyle:a,interactiveLayerIds:t?["points"]:[],onClick:b,onMouseEnter:f=>{var u,d;((d=(u=f.features)==null?void 0:u[0])==null?void 0:d.layer.id)==="points"&&(f.target.getCanvas().style.cursor="pointer")},onMouseLeave:f=>{f.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://3x3.zone'>3x3.zone</a> <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[s.jsx(O,{position:"top-right"}),t&&s.jsx(k,{id:"points-source",type:"geojson",data:t,children:s.jsx(B,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":m,"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),g&&s.jsx(z,{longitude:g.longitude,latitude:g.latitude,anchor:"bottom",onClose:()=>S(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:s.jsxs("div",{className:"p-1",children:[s.jsx("h3",{className:"font-bold text-gray-800",children:g.name}),g.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g.description})]})})]})]})},te=function(){return s.jsx(K,{})};export{te as component};
