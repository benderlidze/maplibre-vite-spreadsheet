import{r as v,j as s}from"./index-DiIIn6fF.js";import{M as A,a as D,N as O,S as k,L as B,P as Z,g as z}from"./csvParse-CA22xSAF.js";var M={},R={},L=34,w=10,T=13;function I(t){return new Function("d","return {"+t.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function J(t,n){var r=I(t);return function(o,l){return n(r(o),l,t)}}function P(t){var n=Object.create(null),r=[];return t.forEach(function(o){for(var l in o)l in n||r.push(n[l]=l)}),r}function f(t,n){var r=t+"",o=r.length;return o<n?new Array(n-o+1).join(0)+r:r}function V(t){return t<0?"-"+f(-t,6):t>9999?"+"+f(t,6):f(t,4)}function Y(t){var n=t.getUTCHours(),r=t.getUTCMinutes(),o=t.getUTCSeconds(),l=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":V(t.getUTCFullYear())+"-"+f(t.getUTCMonth()+1,2)+"-"+f(t.getUTCDate(),2)+(l?"T"+f(n,2)+":"+f(r,2)+":"+f(o,2)+"."+f(l,3)+"Z":o?"T"+f(n,2)+":"+f(r,2)+":"+f(o,2)+"Z":r||n?"T"+f(n,2)+":"+f(r,2)+"Z":"")}function q(t){var n=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function o(e,a){var m,i,c=l(e,function(C,h){if(m)return m(C,h-1);i=C,m=a?J(C,a):I(C)});return c.columns=i||[],c}function l(e,a){var m=[],i=e.length,c=0,C=0,h,x=i<=0,u=!1;e.charCodeAt(i-1)===w&&--i,e.charCodeAt(i-1)===T&&--i;function p(){if(x)return R;if(u)return u=!1,M;var y,b=c,N;if(e.charCodeAt(b)===L){for(;c++<i&&e.charCodeAt(c)!==L||e.charCodeAt(++c)===L;);return(y=c)>=i?x=!0:(N=e.charCodeAt(c++))===w?u=!0:N===T&&(u=!0,e.charCodeAt(c)===w&&++c),e.slice(b+1,y-1).replace(/""/g,'"')}for(;c<i;){if((N=e.charCodeAt(y=c++))===w)u=!0;else if(N===T)u=!0,e.charCodeAt(c)===w&&++c;else if(N!==r)continue;return e.slice(b,y)}return x=!0,e.slice(b,i)}for(;(h=p())!==R;){for(var d=[];h!==M&&h!==R;)d.push(h),h=p();a&&(d=a(d,C++))==null||m.push(d)}return m}function F(e,a){return e.map(function(m){return a.map(function(i){return j(m[i])}).join(t)})}function g(e,a){return a==null&&(a=P(e)),[a.map(j).join(t)].concat(F(e,a)).join(`
`)}function S(e,a){return a==null&&(a=P(e)),F(e,a).join(`
`)}function U(e){return e.map(E).join(`
`)}function E(e){return e.map(j).join(t)}function j(e){return e==null?"":e instanceof Date?Y(e):n.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:o,parseRows:l,format:g,formatBody:S,formatRows:U,formatRow:E,formatValue:j}}var G=q(","),H=G.parse;function Q(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function W(t,n){return fetch(t,n).then(Q)}function _(t){return function(n,r,o){return arguments.length===2&&typeof r=="function"&&(o=r,r=void 0),W(n,r).then(function(l){return t(l,o)})}}var $=_(H);const K=()=>{const[t,n]=v.useState(null),[r,o]=v.useState(!0),[l,F]=v.useState(null),[g,S]=v.useState(null),E=new URLSearchParams(window.location.hash.split("?")[1]||"").get("mapFields")??"{}",j=decodeURIComponent(E),e=v.useMemo(()=>{try{return JSON.parse(j)}catch(u){return console.error("Failed to parse mapFields parameter:",u),{}}},[j]),a=A[e.mapStyle]||A.Light,m=e.pinColor??"#007cbf",i=e.mapCenter||{lat:0,lng:0},c=e.mapZoom||1,C=e.mapPitch||0,h=e.mapBearing||0;v.useEffect(()=>{(async()=>{try{if(e.dataURL&&e.dataURL.length>10){const p=await $(e.dataURL);console.log("csvData",p);const d=z({data:p,latField:e.latField,lngField:e.lngField,nameField:e.nameField,descField:e.descField});n(d),o(!1)}}catch(p){console.error("Failed to parse mapFields parameter:",p),F("Invalid mapFields parameter in URL"),o(!1)}})()},[e]);const x=v.useCallback(u=>{var d;const p=(d=u.features)==null?void 0:d[0];if(p&&p.geometry.type==="Point"){const[y,b]=p.geometry.coordinates;S({longitude:y,latitude:b,name:p.properties.name,description:p.properties.description})}},[]);return s.jsxs("div",{className:"h-screen relative",children:[r&&s.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),l&&s.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[s.jsx("p",{className:"font-bold",children:"Error"}),s.jsx("p",{children:l})]})}),s.jsxs(D,{initialViewState:{longitude:i.lng,latitude:i.lat,zoom:c,pitch:C,bearing:h},style:{width:"100%",height:"100%"},mapStyle:a,interactiveLayerIds:t?["points"]:[],onClick:x,onMouseEnter:u=>{var p,d;((d=(p=u.features)==null?void 0:p[0])==null?void 0:d.layer.id)==="points"&&(u.target.getCanvas().style.cursor="pointer")},onMouseLeave:u=>{u.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://geomapi.com/'>geomapi.com</a> <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[s.jsx(O,{position:"top-right"}),t&&s.jsx(k,{id:"points-source",type:"geojson",data:t,children:s.jsx(B,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":m,"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),g&&s.jsx(Z,{longitude:g.longitude,latitude:g.latitude,anchor:"bottom",onClose:()=>S(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:s.jsxs("div",{className:"p-1",children:[s.jsx("h3",{className:"font-bold text-gray-800",children:g.name}),g.description&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g.description})]})})]})]})},te=function(){return s.jsx(K,{})};export{te as component};
