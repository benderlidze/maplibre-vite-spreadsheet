import{r as C,j as c}from"./index-D02kCSwA.js";import{M as A,a as D,N as O,S as k,L as B,P as Z,g as z}from"./csvParse-CNvC_X-R.js";var I={},L={},R=34,w=10,T=13;function P(t){return new Function("d","return {"+t.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function J(t,n){var r=P(t);return function(a,l){return n(r(a),l,t)}}function M(t){var n=Object.create(null),r=[];return t.forEach(function(a){for(var l in a)l in n||r.push(n[l]=l)}),r}function p(t,n){var r=t+"",a=r.length;return a<n?new Array(n-a+1).join(0)+r:r}function V(t){return t<0?"-"+p(-t,6):t>9999?"+"+p(t,6):p(t,4)}function Y(t){var n=t.getUTCHours(),r=t.getUTCMinutes(),a=t.getUTCSeconds(),l=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":V(t.getUTCFullYear())+"-"+p(t.getUTCMonth()+1,2)+"-"+p(t.getUTCDate(),2)+(l?"T"+p(n,2)+":"+p(r,2)+":"+p(a,2)+"."+p(l,3)+"Z":a?"T"+p(n,2)+":"+p(r,2)+":"+p(a,2)+"Z":r||n?"T"+p(n,2)+":"+p(r,2)+"Z":"")}function q(t){var n=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function a(e,o){var m,s,i=l(e,function(j,h){if(m)return m(j,h-1);s=j,m=o?J(j,o):P(j)});return i.columns=s||[],i}function l(e,o){var m=[],s=e.length,i=0,j=0,h,x=s<=0,u=!1;e.charCodeAt(s-1)===w&&--s,e.charCodeAt(s-1)===T&&--s;function f(){if(x)return L;if(u)return u=!1,I;var y,b=i,N;if(e.charCodeAt(b)===R){for(;i++<s&&e.charCodeAt(i)!==R||e.charCodeAt(++i)===R;);return(y=i)>=s?x=!0:(N=e.charCodeAt(i++))===w?u=!0:N===T&&(u=!0,e.charCodeAt(i)===w&&++i),e.slice(b+1,y-1).replace(/""/g,'"')}for(;i<s;){if((N=e.charCodeAt(y=i++))===w)u=!0;else if(N===T)u=!0,e.charCodeAt(i)===w&&++i;else if(N!==r)continue;return e.slice(b,y)}return x=!0,e.slice(b,s)}for(;(h=f())!==L;){for(var d=[];h!==I&&h!==L;)d.push(h),h=f();o&&(d=o(d,j++))==null||m.push(d)}return m}function F(e,o){return e.map(function(m){return o.map(function(s){return v(m[s])}).join(t)})}function g(e,o){return o==null&&(o=M(e)),[o.map(v).join(t)].concat(F(e,o)).join(`
`)}function E(e,o){return o==null&&(o=M(e)),F(e,o).join(`
`)}function U(e){return e.map(S).join(`
`)}function S(e){return e.map(v).join(t)}function v(e){return e==null?"":e instanceof Date?Y(e):n.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:a,parseRows:l,format:g,formatBody:E,formatRows:U,formatRow:S,formatValue:v}}var G=q(","),H=G.parse;function Q(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function W(t,n){return fetch(t,n).then(Q)}function _(t){return function(n,r,a){return arguments.length===2&&typeof r=="function"&&(a=r,r=void 0),W(n,r).then(function(l){return t(l,a)})}}var $=_(H);const ee=()=>{const[t,n]=C.useState(null),[r,a]=C.useState(!0),[l,F]=C.useState(null),[g,E]=C.useState(null),S=new URLSearchParams(window.location.search).get("mapFields")??"",v=decodeURIComponent(S),e=C.useMemo(()=>{try{return JSON.parse(v)}catch(u){return console.error("Failed to parse mapFields parameter:",u),{}}},[v]),o=A[e.mapStyle]||A.Light,m=e.pinColor??"#007cbf",s=e.mapCenter||{lat:0,lng:0},i=e.mapZoom||1,j=e.mapPitch||0,h=e.mapBearing||0;C.useEffect(()=>{(async()=>{try{if(e.dataURL&&e.dataURL.length>10){const f=await $(e.dataURL);console.log("csvData",f);const d=z({data:f,latField:e.latField,lngField:e.lngField,nameField:e.nameField,descField:e.descField});n(d),a(!1)}}catch(f){console.error("Failed to parse mapFields parameter:",f),F("Invalid mapFields parameter in URL"),a(!1)}})()},[e]);const x=C.useCallback(u=>{var d;const f=(d=u.features)==null?void 0:d[0];if(f&&f.geometry.type==="Point"){const[y,b]=f.geometry.coordinates;E({longitude:y,latitude:b,name:f.properties.name,description:f.properties.description})}},[]);return c.jsxs("div",{className:"h-screen relative",children:[r&&c.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),l&&c.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:c.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[c.jsx("p",{className:"font-bold",children:"Error"}),c.jsx("p",{children:l})]})}),c.jsxs(D,{initialViewState:{longitude:s.lng,latitude:s.lat,zoom:i,pitch:j,bearing:h},style:{width:"100%",height:"100%"},mapStyle:o,interactiveLayerIds:t?["points"]:[],onClick:x,onMouseEnter:u=>{var f,d;((d=(f=u.features)==null?void 0:f[0])==null?void 0:d.layer.id)==="points"&&(u.target.getCanvas().style.cursor="pointer")},onMouseLeave:u=>{u.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://geomapi.com/'>geomapi.com</a> <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[c.jsx(O,{position:"top-right"}),t&&c.jsx(k,{id:"points-source",type:"geojson",data:t,children:c.jsx(B,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":m,"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),g&&c.jsx(Z,{longitude:g.longitude,latitude:g.latitude,anchor:"bottom",onClose:()=>E(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:c.jsxs("div",{className:"p-1",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:g.name}),g.description&&c.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g.description})]})})]})]})};export{ee as I};
