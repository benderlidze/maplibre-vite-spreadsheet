import{r as g,j as l}from"./index-Cp3jmcdL.js";import{M as I,a as O,N as B,S as Z,L as k,P as z,g as V}from"./csvParse-4PSjikvu.js";const T={dataURL:"",latField:0,lngField:0,nameField:"name",descField:"description",mapStyle:"Light",pinColor:"007cbf",mapCenter:[0,0],mapZoom:1,mapPitch:0,mapBearing:0},Y=()=>{const[e,r]=g.useState(T);return g.useEffect(()=>{const n=()=>{const c=window.location.search,d={...T};if(!c)return d;new URLSearchParams(c).forEach((f,m)=>{console.log("value,key",f,m),m==="pinColor"?d.pinColor=f:m==="mapCenter"?d.mapCenter=f.split(",").map(Number):m in d&&f!==""&&(d[m]=f)}),r(d)};n();const i=()=>{n()};return window.addEventListener("popstate",i),()=>window.removeEventListener("popstate",i)},[]),e};var A={},L={},R=34,y=10,P=13;function D(e){return new Function("d","return {"+e.map(function(r,n){return JSON.stringify(r)+": d["+n+'] || ""'}).join(",")+"}")}function J(e,r){var n=D(e);return function(i,c){return r(n(i),c,e)}}function M(e){var r=Object.create(null),n=[];return e.forEach(function(i){for(var c in i)c in r||n.push(r[c]=c)}),n}function p(e,r){var n=e+"",i=n.length;return i<r?new Array(r-i+1).join(0)+n:n}function Q(e){return e<0?"-"+p(-e,6):e>9999?"+"+p(e,6):p(e,4)}function $(e){var r=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),c=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Q(e.getUTCFullYear())+"-"+p(e.getUTCMonth()+1,2)+"-"+p(e.getUTCDate(),2)+(c?"T"+p(r,2)+":"+p(n,2)+":"+p(i,2)+"."+p(c,3)+"Z":i?"T"+p(r,2)+":"+p(n,2)+":"+p(i,2)+"Z":n||r?"T"+p(r,2)+":"+p(n,2)+"Z":"")}function q(e){var r=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(t,o){var s,a,u=c(t,function(h,j){if(s)return s(h,j-1);a=h,s=o?J(h,o):D(h)});return u.columns=a||[],u}function c(t,o){var s=[],a=t.length,u=0,h=0,j,F=a<=0,v=!1;t.charCodeAt(a-1)===y&&--a,t.charCodeAt(a-1)===P&&--a;function U(){if(F)return L;if(v)return v=!1,A;var E,S=u,b;if(t.charCodeAt(S)===R){for(;u++<a&&t.charCodeAt(u)!==R||t.charCodeAt(++u)===R;);return(E=u)>=a?F=!0:(b=t.charCodeAt(u++))===y?v=!0:b===P&&(v=!0,t.charCodeAt(u)===y&&++u),t.slice(S+1,E-1).replace(/""/g,'"')}for(;u<a;){if((b=t.charCodeAt(E=u++))===y)v=!0;else if(b===P)v=!0,t.charCodeAt(u)===y&&++u;else if(b!==n)continue;return t.slice(S,E)}return F=!0,t.slice(S,a)}for(;(j=U())!==L;){for(var x=[];j!==A&&j!==L;)x.push(j),j=U();o&&(x=o(x,h++))==null||s.push(x)}return s}function d(t,o){return t.map(function(s){return o.map(function(a){return C(s[a])}).join(e)})}function N(t,o){return o==null&&(o=M(t)),[o.map(C).join(e)].concat(d(t,o)).join(`
`)}function f(t,o){return o==null&&(o=M(t)),d(t,o).join(`
`)}function m(t){return t.map(w).join(`
`)}function w(t){return t.map(C).join(e)}function C(t){return t==null?"":t instanceof Date?$(t):r.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:i,parseRows:c,format:N,formatBody:f,formatRows:m,formatRow:w,formatValue:C}}var G=q(","),H=G.parse;function W(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function _(e,r){return fetch(e,r).then(W)}function K(e){return function(r,n,i){return arguments.length===2&&typeof n=="function"&&(i=n,n=void 0),_(r,n).then(function(c){return e(c,i)})}}var X=K(H);const ee=({params:e})=>{var C,t;console.log("params",e);const[r,n]=g.useState(null),[i,c]=g.useState(!0),[d,N]=g.useState(null),[f,m]=g.useState(null);g.useEffect(()=>{(async()=>{try{if(e.dataURL&&e.dataURL.length>10){const s=await X(e.dataURL),a=V({data:s,latField:e.latField??0,lngField:e.lngField??0,nameField:e.nameField,descField:e.descField});n(a),c(!1)}}catch(s){console.error("Failed to parse mapFields parameter:",s),N("Invalid mapFields parameter in URL"),c(!1)}})()},[e]);const w=g.useCallback(o=>{var a;const s=(a=o.features)==null?void 0:a[0];if(s&&s.geometry.type==="Point"){const[u,h]=s.geometry.coordinates;m({longitude:u,latitude:h,name:s.properties.name,description:s.properties.description})}},[]);return l.jsxs("div",{className:"h-screen relative",children:[i&&l.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),l.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),d&&l.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:l.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[l.jsx("p",{className:"font-bold",children:"Error"}),l.jsx("p",{children:d})]})}),!i&&l.jsxs(I,{initialViewState:{longitude:Number((C=e.mapCenter)==null?void 0:C[1])||0,latitude:Number((t=e.mapCenter)==null?void 0:t[0])||0,zoom:Number(e.mapZoom)||1,pitch:Number(e.mapPitch)||0,bearing:Number(e.mapBearing)||0},style:{width:"100%",height:"100%"},mapStyle:O[e.mapStyle],interactiveLayerIds:r?["points"]:[],onClick:w,onMouseEnter:o=>{var s,a;((a=(s=o.features)==null?void 0:s[0])==null?void 0:a.layer.id)==="points"&&(o.target.getCanvas().style.cursor="pointer")},onMouseLeave:o=>{o.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://geomapi.com/'>geomapi.com</a> <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[l.jsx(B,{position:"top-right"}),r&&l.jsx(Z,{id:"points-source",type:"geojson",data:r,children:l.jsx(k,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":e.pinColor?`#${e.pinColor}`:"#007cbf","circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),f&&l.jsx(z,{longitude:f.longitude,latitude:f.latitude,anchor:"bottom",onClose:()=>m(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:l.jsxs("div",{className:"p-1",children:[l.jsx("h3",{className:"font-bold text-gray-800",children:f.name}),f.description&&l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:f.description})]})})]})]})},te=()=>{const e=Y();return l.jsx(ee,{params:e})},oe=function(){return l.jsx(te,{})};export{oe as component};
