import{r as j,j as c}from"./index-Vs-pDNT5.js";import{M as A,a as P,N as O,S as k,L as z,P as B,g as J}from"./csvParse-oOAnhXC3.js";var I={},E={},R=34,y=10,L=13;function D(t){return new Function("d","return {"+t.map(function(o,n){return JSON.stringify(o)+": d["+n+'] || ""'}).join(",")+"}")}function V(t,o){var n=D(t);return function(s,l){return o(n(s),l,t)}}function M(t){var o=Object.create(null),n=[];return t.forEach(function(s){for(var l in s)l in o||n.push(o[l]=l)}),n}function f(t,o){var n=t+"",s=n.length;return s<o?new Array(o-s+1).join(0)+n:n}function Y(t){return t<0?"-"+f(-t,6):t>9999?"+"+f(t,6):f(t,4)}function Z(t){var o=t.getUTCHours(),n=t.getUTCMinutes(),s=t.getUTCSeconds(),l=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Y(t.getUTCFullYear())+"-"+f(t.getUTCMonth()+1,2)+"-"+f(t.getUTCDate(),2)+(l?"T"+f(o,2)+":"+f(n,2)+":"+f(s,2)+"."+f(l,3)+"Z":s?"T"+f(o,2)+":"+f(n,2)+":"+f(s,2)+"Z":n||o?"T"+f(o,2)+":"+f(n,2)+"Z":"")}function q(t){var o=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function s(e,i){var d,a,r=l(e,function(u,p){if(d)return d(u,p-1);a=u,d=i?V(u,i):D(u)});return r.columns=a||[],r}function l(e,i){var d=[],a=e.length,r=0,u=0,p,v=a<=0,g=!1;e.charCodeAt(a-1)===y&&--a,e.charCodeAt(a-1)===L&&--a;function U(){if(v)return E;if(g)return g=!1,I;var F,S=r,C;if(e.charCodeAt(S)===R){for(;r++<a&&e.charCodeAt(r)!==R||e.charCodeAt(++r)===R;);return(F=r)>=a?v=!0:(C=e.charCodeAt(r++))===y?g=!0:C===L&&(g=!0,e.charCodeAt(r)===y&&++r),e.slice(S+1,F-1).replace(/""/g,'"')}for(;r<a;){if((C=e.charCodeAt(F=r++))===y)g=!0;else if(C===L)g=!0,e.charCodeAt(r)===y&&++r;else if(C!==n)continue;return e.slice(S,F)}return v=!0,e.slice(S,a)}for(;(p=U())!==E;){for(var w=[];p!==I&&p!==E;)w.push(p),p=U();i&&(w=i(w,u++))==null||d.push(w)}return d}function x(e,i){return e.map(function(d){return i.map(function(a){return h(d[a])}).join(t)})}function m(e,i){return i==null&&(i=M(e)),[i.map(h).join(t)].concat(x(e,i)).join(`
`)}function b(e,i){return i==null&&(i=M(e)),x(e,i).join(`
`)}function T(e){return e.map(N).join(`
`)}function N(e){return e.map(h).join(t)}function h(e){return e==null?"":e instanceof Date?Z(e):o.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:s,parseRows:l,format:m,formatBody:b,formatRows:T,formatRow:N,formatValue:h}}var G=q(","),H=G.parse;function Q(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function W(t,o){return fetch(t,o).then(Q)}function _(t){return function(o,n,s){return arguments.length===2&&typeof n=="function"&&(s=n,n=void 0),W(o,n).then(function(l){return t(l,s)})}}var $=_(H);const K=()=>{const[t,o]=j.useState(null),[n,s]=j.useState(!0),[l,x]=j.useState(null),[m,b]=j.useState(null),N=new URLSearchParams(window.location.search).get("mapFields")??"",h=decodeURIComponent(N),e=JSON.parse(h),i=A[e.mapStyle]||A.Light;console.log("parsedFields",e),j.useEffect(()=>{(async()=>{try{if(e.dataURL&&e.dataURL.length>10){const r=await $(e.dataURL);console.log("csvData",r);const u=J({data:r,latField:e.latField,lngField:e.lngField,nameField:e.nameField,descField:e.descField});o(u),s(!1)}}catch(r){console.error("Failed to parse mapFields parameter:",r),x("Invalid mapFields parameter in URL"),s(!1)}})()},[]);const d=j.useCallback(a=>{var u;const r=(u=a.features)==null?void 0:u[0];if(r&&r.geometry.type==="Point"){const[p,v]=r.geometry.coordinates;b({longitude:p,latitude:v,name:r.properties.name,description:r.properties.description})}},[]);return c.jsxs("div",{className:"h-screen relative",children:[n&&c.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),c.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),l&&c.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:c.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[c.jsx("p",{className:"font-bold",children:"Error"}),c.jsx("p",{children:l})]})}),c.jsxs(P,{initialViewState:{longitude:0,latitude:0,zoom:1},style:{width:"100%",height:"100%"},mapStyle:i,interactiveLayerIds:t?["points"]:[],onClick:d,onMouseEnter:a=>{var r,u;((u=(r=a.features)==null?void 0:r[0])==null?void 0:u.layer.id)==="points"&&(a.target.getCanvas().style.cursor="pointer")},onMouseLeave:a=>{a.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://3x3.zone'>3x3.zone</a> <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[c.jsx(O,{position:"top-right"}),t&&c.jsx(k,{id:"points-source",type:"geojson",data:t,children:c.jsx(z,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":"#3b82f6","circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),m&&c.jsx(B,{longitude:m.longitude,latitude:m.latitude,anchor:"bottom",onClose:()=>b(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:c.jsxs("div",{className:"p-1",children:[c.jsx("h3",{className:"font-bold text-gray-800",children:m.name}),m.description&&c.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m.description})]})})]})]})},te=function(){return c.jsx(K,{})};export{te as component};
