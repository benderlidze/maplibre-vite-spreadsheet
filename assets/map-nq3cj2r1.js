import{r as n,j as t}from"./index-pzfDBdG-.js";import{f as M,M as E,a as R,N as D,S as U,L as k,P as J}from"./csvParse-Biw5r2E5.js";const z=()=>{const[l,b]=n.useState(null),[v,c]=n.useState(!0),[u,d]=n.useState(null),[r,F]=n.useState(null),[i,m]=n.useState(null),f=new URLSearchParams(window.location.search),C=f.get("style")??"Light",I=R[C];n.useEffect(()=>{try{const a=f.get("mapFields");if(!a){d("No mapFields parameter found in URL"),c(!1);return}const e=decodeURIComponent(a),s=JSON.parse(e);F(s)}catch(a){console.error("Failed to parse mapFields parameter:",a),d("Invalid mapFields parameter in URL"),c(!1)}},[]),n.useEffect(()=>{if(!(r!=null&&r.dataURL))return;const a=(e,s)=>{const p=s.filter(o=>o.length>=2).map((o,w)=>{const g=e.indexOf(r.latField),x=e.indexOf(r.lngField),h=e.indexOf(r.nameField),y=e.indexOf(r.descField);if(g<0||x<0)return null;const S=parseFloat(o[g]),j=parseFloat(o[x]);return isNaN(S)||isNaN(j)?null:{type:"Feature",geometry:{type:"Point",coordinates:[j,S]},properties:{id:w,name:h>=0?o[h]:"Unnamed",description:y>=0?o[y]:"",...e.reduce((N,O,P)=>(N[O]=o[P],N),{})}}}).filter(Boolean);b({type:"FeatureCollection",features:p}),c(!1)};M({url:r.dataURL,setIsLoading:c,setError:d,setHeaders:e=>{const s=sessionStorage.getItem("csvData");s&&a(e,JSON.parse(s))},setCsvData:e=>{sessionStorage.setItem("csvData",JSON.stringify(e));const s=sessionStorage.getItem("headers");s&&a(JSON.parse(s),e)}})},[r]);const L=n.useCallback(a=>{var s;const e=(s=a.features)==null?void 0:s[0];if(e&&e.geometry.type==="Point"){const[p,o]=e.geometry.coordinates;m({longitude:p,latitude:o,name:e.properties.name,description:e.properties.description})}},[]);return t.jsxs("div",{className:"h-screen relative",children:[v&&t.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.jsx("p",{className:"text-gray-700 font-medium",children:"Loading map data..."})]})}),u&&t.jsx("div",{className:"flex items-center justify-center absolute z-10 h-full w-full bg-white bg-opacity-80",children:t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[t.jsx("p",{className:"font-bold",children:"Error"}),t.jsx("p",{children:u})]})}),t.jsxs(E,{initialViewState:{longitude:0,latitude:0,zoom:1},style:{width:"100%",height:"100%"},mapStyle:I,interactiveLayerIds:l?["points"]:[],onClick:L,onMouseEnter:a=>{var e,s;((s=(e=a.features)==null?void 0:e[0])==null?void 0:s.layer.id)==="points"&&(a.target.getCanvas().style.cursor="pointer")},onMouseLeave:a=>{a.target.getCanvas().style.cursor=""},attributionControl:{customAttribution:"Â© <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"},children:[t.jsx(D,{position:"top-right"}),l&&t.jsx(U,{id:"points-source",type:"geojson",data:l,children:t.jsx(k,{id:"points",type:"circle",source:"points-source",paint:{"circle-radius":6,"circle-color":"#3b82f6","circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.9}})}),i&&t.jsx(J,{longitude:i.longitude,latitude:i.latitude,anchor:"bottom",onClose:()=>m(null),closeButton:!0,closeOnClick:!1,className:"map-popup",children:t.jsxs("div",{className:"p-1",children:[t.jsx("h3",{className:"font-bold text-gray-800",children:i.name}),i.description&&t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i.description})]})})]})]})},B=function(){return t.jsx(z,{})};export{B as component};
